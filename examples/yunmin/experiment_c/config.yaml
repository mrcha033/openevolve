# Track selection is via AI_OPT_TRACK env var (baseline|gpt5|profiler|gpt5_profiler).
# LLM api_base and model are overridden by run_track.sh CLI flags.
max_iterations: 50
checkpoint_interval: 10
parallel_evaluations: 1
language: cpp
diff_based_evolution: true
max_code_length: 200000

llm:
  api_base: "http://127.0.0.1:8000/v1"  # default; overridden by --api-base
  models:
    - name: "local-model"  # default; overridden by --primary-model
      weight: 1.0
  temperature: 0.5
  max_tokens: 8000
  timeout: 180

database:
  population_size: 30
  num_islands: 2
  migration_interval: 10
  feature_dimensions:
    - "ops_per_sec"
    - "p99_latency_us"

evaluator:
  timeout: 900
  max_retries: 1

prompt:
  system_message: |
    You are a C++ performance engineer specializing in storage-engine internals.
    Your task is to reduce compaction latency by optimizing the
    CompactionJob::ProcessKeyValueCompaction() function.

    You are viewing a FUNCTION SLICE extracted from db/compaction/compaction_job.cc.
    This is the complete function — modify any part of it freely.

    Key types and APIs used in this function:
    - SubcompactionState: holds per-subcompaction state (compaction, output, stats)
    - CompactionIterator (c_iter): merges input from multiple SST files
    - CompactionRangeDelAggregator: handles range deletions during compaction
    - CompactionFileOpenFunc / CompactionFileCloseFunc: manage output SST files
    - sub_compact->compaction: the Compaction descriptor (levels, input files)
    - sub_compact->AddToOutput(): writes KV pairs to current output file
    - BlobFileBuilder: handles blob (large value) separation
    - RecordTick() / SetTickerCount(): statistics tracking
    - TEST_SYNC_POINT(): testing hooks (must be preserved)

    Optimization strategies:
    1. Prefetching/pipelining: overlap reading the next SST data block with
       processing the current one (ReadOptions::readahead_size, Prefetch())
    2. Amortized locking: batch per-key mutex acquisitions
    3. Reduce per-key overhead in the inner compaction loop

    Constraints:
    - Compaction output must remain byte-identical (correctness first)
    - No new external dependencies
    - Stay local — do not rewrite the thread-pool scheduler or add new files
    - Changes must compile with the existing RocksDB build system
  num_top_programs: 3
  num_diverse_programs: 2

log_level: "INFO"
